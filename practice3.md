# Практика 3 — 4.1 Репликация

## ТЗ

- Реализовать репликасет `geojson` базы данных с протоколом репликации и векторными часами

## Архитектура

![Architecture](img/practice3-arch.png)

## ТЗ

Горутина `Engine` при запуске должна прочитать чекпоинт файл с данными затем должна прочитать файл с журналом транзакций.

После горутина `Engine` должна подключится ко всем репликам из списка `replicas` и подключится именно на websocket `/replication` ендпоинт.
Горутина `Engine` должна принимать новые транзакции как из канала транзакций так и из исходящих подключений `replicas`.

Отдельно хендлер websocket `/replication` должен принимать подключения и создавать реестр реплик, которым мы должны отправлять транзакции: `map[string]connection`

Горутина `Engine` должна отправлять только свои локальные тразанкции (транзакции у которых name совпадает с name Storage) соседям из реестра реплик.

Горутина должна управлять переменной `vclock` (это векторные часы) `map[string]uint64`, которая содержит в себе `LSN` всех применённых транзакций со всех узлов. 
И с помощью переменной `vclock` и `LSN` у каждой транзакции фильтровать уже применённые транзакции.

Создавать новые транзакции может только `Storage` у которого `leader == true`.

В `main` создать несколько сервисов Storage. В каждом из них перечислить адреса соседних сервисов Storage. Таким образом сделать топологию `fullmesh`.

## Добавить HTTP API

- В объекте Storage сделать
- `websocket` `/replication` 
  - Здесь новые соединения располагать в реесте подключенных реплик.

- `GET /select`
  - Реализовать счетчик текущих запросов
    - При достижении порогового значения (например 3)
    - Редиректить на реплику
    - Реализовать защиту от бесконечных редиректов
